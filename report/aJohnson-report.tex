% Report for MATH6641 Project
% Copyright (C) 2018 Andrew Johnson, GTRC
% This program is free software: you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation, either version 3 of the License, or
% (at your option) any later version.
% 
% This program is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.
% 
% You should have received a copy of the GNU General Public License
% along with this program.  If not, see <http://www.gnu.org/licenses/>.
\documentclass{article}
\usepackage{amsmath}
\usepackage{booktabs}
\usepackage{tikz}
\newcommand{\mfes}{\mathcal{V}}
\newcommand{\pdiff}[2]{\frac{\partial#1}{\partial#2}}
\newcommand{\ddx}[1]{\pdiff{#1}{x}}
\newcommand{\ddt}[1]{\pdiff{#1}{t}}
\newcommand{\dpmdx}{\ddx{\psi_m}}
\newcommand{\dpmdt}{\ddt{\psi_m}}
\newcommand{\fisTrms}{\chi\nu\sigma_f}
\newcommand{\tfor}{\text{ for }}
\newcommand{\tfes}{finite-element space }
\newcommand{\tfem}{finite-element method }
\title{$FeS_NT$ - A Finite Element Neutron Transport Solver}
\author{Andrew Johnson}
\usepackage[left=1in,right=1in,top=0.75in,bottom=1in]{geometry}
\usepackage{cleveref}

\begin{document}

\maketitle

\section{Introduction}
The goal of this work is to introduce and explain the code written for the MATH6641 project.
The time-dependent one-dimensional neutron transport equation was solved using the discrete 
ordinates formulation \textbf{cite} using discontinuous-Galerkin in space, and
explicit Euler for time.
The project was written in Python and works best with 3.5\footnote{not tested on other versions}
and is included with this report in \texttt{fesnt.py}.
This report, and the code included, are covered with the GNU Public License, found in \texttt{LICENSE}.

\subsection{Problem Statement}
The discrete-ordinates formulation of the neutron transport equation chooses to solve for the angular
neutron flux, $\psi(x, \mu, t)$ along a discrete set of $N$ angles $\vec{\mu}$. A quadrature set of 
weights and angles is chosen to satisfy some physical constraints, briefly summarized here:
\begin{subequations} \label{eq:quadRules}
    \begin{equation}
        \mu_m = -\mu_{N-m+1}
    \end{equation}
    \begin{equation}
        w_m = w_{N-m+1}
    \end{equation}
    \begin{equation}
        \sum_m w_m = 2
    \end{equation}
    \begin{equation}
        \int_{-1}^1f(x, \mu)d\mu\approx\sum_mw_m f(x, \mu_m)
    \end{equation}
\end{subequations}

The weights and angles are, for this work, chosen from a Guass-Legendre polynomial set.
%TODO: verify and cite
Select sets of weights and angles are listed in \cref{sec:qsets}

This project seeks to solve the following initial-boundary value problem:
\begin{equation} \label{eq:ibvpNTE}
    \frac{1}{\nu}\dpmdt+\mu_m\dpmdx+\sigma_t(x)\psi(x, t) = \frac{1}{2}\left(\sigma_{s0}+\fisTrms\right)
    \sum_mw_m\psi_m(x, t), \tfor a<x<b,t>0, \mu_m\in\vec{\mu}
\end{equation}
subject to initial and boundary conditions
\begin{subequations}
    \begin{equation}
        \psi_m(x, 0) = \psi_{m,0}(x), \tfor a<x<b, \mu_m\in\vec{\mu}
    \end{equation}
    \begin{equation}
        \psi_m(a, t) = \Gamma_a(\mu_m, t)\tfor \mu_m>0,t>0
    \end{equation}
    \begin{equation}
        \psi_m(b, t) = \Gamma_b(\mu_m, t)\tfor\mu_m<0, t>0
    \end{equation}
\end{subequations}

The report is laid out as follows. \Cref{sec:derive} derives the numerical scheme implemented
for this project. \Cref{sec:implement} gives some insight into the actual implementation
and usage needed to reproduce the results. \Cref{sec:results} presents results from
three test cases of increasing difficulty.

\section{Derivation of the Method} \label{sec:derive}
The author set out to apply a finite-element scheme for the spatial domain, with an implicit Euler
scheme in time. This section shall detail the mathematical foundation for the project, and present the
numeric scheme that was ultimately implemented for this work.

\subsection{Finite-Element Method}
Following the work of Reed and \textbf{other guy}, %TODO: cite reed work
the author set out to apply a Discontinuous-Galerkin (DG) method for the spatial domain.
This required subdividing the domain $a<x<b$ into non-overlapping elements $\tau$.
The \tfes $\mfes$ was chosen to be piece-wise quadratic polynomials that are continuous 
within a single element.
\subsubsection{Quadratic Flux}
Within each element $\tau$, the flux was represented as a quadratic function using the element boundaries and 
midpoint of the element.
Specifically, the angular flux was represented using Lagrange interpolating polynomials, as
\begin{equation}
    \label{eq:fluxPoly}
    \psi_m(x) = \sum_{j=0}^2\psi_{m,j}\sum_{l=0}^2\alpha_{j,l}x^l
    = \sum_{j=0}^2\psi_{m,j}\prod_{l=0,l\neq j}^2\frac{x-x_l}{x_j-x_l}
\end{equation}
This way, given three internal points of element $\tau$, the Lagrange coefficients
$\alpha_{j,l}$ could be determined, meaning that amplitudes $\psi_{m,j}$ remained to
be solved.
The benefit of using Lagrange polynomials is that, at a specific lattice site $x_l$, the 
angular flux evaluates to the specific polynomial amplitude, i.e.
\begin{equation}
    \psi_m(x_j) = \psi_{m,j}
\end{equation}

Using a quadratic representation of the flux within an element allows the use of Simpson's
integration without introducing additional error, as such a method is exact for polynomials
of order 2 or less.
According to Simpson's rule, the spatial integral of a function can be expressed as
\begin{equation}
    \label{eq:simpsInt}
    \int_a^bf(x)dx \approx \frac{b-a}{2}\left(f(a) + 4f\left(\frac{b-a}{2}\right) + f(b)\right)
\end{equation}

\subsubsection{Upwind/Downwind Elements}
The scheme implemented iterates through all angles in the quadrature set, and marches through
elements in a manner akin to following the wind-direction. When $mu$ is less than zero, this 
translates to moving left along the $x$ axis, and the first mesh is taken to be the mesh
with an edge at $x=b$. 
Such a scheme requires distinctions to be made between upwind and downwind sides, as will be utilized
heavily in later sections. \Cref{fig:upwDnw} describes the upwind side of the edges of element $\tau$
as $-$ sides, and downwind sides as $+$.

\begin{figure}
    \centering
    \begin{tikzpicture}
        \input{./femNotation.tex}
    \end{tikzpicture}
    \caption{Notation used to denote upwind and downwind elements given flux angle $\mu$}
    \label{fig:upwDnw}
\end{figure}

\section{Implementation} \label{sec:implement}

\subsection{Using \texttt{fesnt.py}} \label{sec:usage}

\section{Results} \label{sec:results}

\subsection{Case 1: Pure-Absorber} \label{sec:pa}

\subsection{Case 2: Non-fissile} \label{sec:nonFissile}

\subsection{Case 3: Fissile Problem} \label{sec:fissile}

\section{Conclusion} 

\section{Appendix}

\subsection{Quadrature Sets} \label{sec:qsets}
The following tables contain the quadrature sets that were used in this work.
For each set, only half of the values are presented, as symmetry rules from \cref{eq:quadRules}
can be used to construct the full set.
%TODO: Cite L&M
%TODO:W: Two columns
\input{../s2.tex}
\input{../s4.tex}
\input{../s8.tex}


\end{document}

